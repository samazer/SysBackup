<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>SysBackup: lib/general-sysutils.inc File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.4 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="multi-function-tool-125px.jpg"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">SysBackup&#160;<span id="projectnumber">v3</span></div>
   <div id="projectbrief">A "swiss-army-knife" automated backup utility for Linux</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('general-sysutils_8inc.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#namespaces">Namespaces</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">general-sysutils.inc File Reference</div>  </div>
</div>
<div class="contents">

<p><a href="general-sysutils_8inc_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classlinux__distro__c.html">linux_distro_c</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classeffective__user__c.html">effective_user_c</a></td></tr>
<tr><td colspan="2"><h2><a name="namespaces"></a>
Namespaces</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">namespace &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="namespaceaforms.html">aforms</a></td></tr>
<tr><td colspan="2"><h2><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="general-sysutils_8inc.html#a156c06fa218f93103eabe6c742e93240">FN_SYS_REDHAT_VERSION</a> </td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="general-sysutils_8inc.html#a877318618d2e1f5d2779e40dfa47d918">FN_SYS_DEBIAN_VERSION</a> </td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="general-sysutils_8inc.html#a9cd4c1a0d42557daac1fc1c94af8eaac">can_hardlink</a> ($target_dir, $source_dir)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="general-sysutils_8inc.html#a02958c3bf0b643439bc3005aa643e954">subfolder_sizes</a> ($dir, $depth=1, $du_opts=&quot;&quot;, $du_bin=false)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="general-sysutils_8inc.html#afdf5bfb4e7162d411c1ba5aef80208cf">disk_usage</a> ($ref)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="general-sysutils_8inc.html#afe814a8de5621ae3af1921ca60a62ef7">_list_folder_items</a> ($folder, $folders_only=true)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="general-sysutils_8inc.html#ae44efd7c9ed854da2e6246f5d1326f47">remove_expired_items</a> ($folder, $max_items, $debug=true, $folders_only=true)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="general-sysutils_8inc.html#ac8c969cd307ea955528ab54a4c307a0f">list_expired_items</a> ($folder, $max_items, $folders_only=true)</td></tr>
</table>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="a877318618d2e1f5d2779e40dfa47d918"></a><!-- doxytag: member="general&#45;sysutils.inc::FN_SYS_DEBIAN_VERSION" ref="a877318618d2e1f5d2779e40dfa47d918" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="general-sysutils_8inc.html#a877318618d2e1f5d2779e40dfa47d918">FN_SYS_DEBIAN_VERSION</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>A file that, if it exists, indicates the current OS is Debian derived </p>

<p>Definition at line <a class="el" href="general-sysutils_8inc_source.html#l00048">48</a> of file <a class="el" href="general-sysutils_8inc_source.html">general-sysutils.inc</a>.</p>

</div>
</div>
<a class="anchor" id="a156c06fa218f93103eabe6c742e93240"></a><!-- doxytag: member="general&#45;sysutils.inc::FN_SYS_REDHAT_VERSION" ref="a156c06fa218f93103eabe6c742e93240" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="general-sysutils_8inc.html#a156c06fa218f93103eabe6c742e93240">FN_SYS_REDHAT_VERSION</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>A file that, if it exists, indicates the current OS is Redhat derived </p>

<p>Definition at line <a class="el" href="general-sysutils_8inc_source.html#l00041">41</a> of file <a class="el" href="general-sysutils_8inc_source.html">general-sysutils.inc</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="afe814a8de5621ae3af1921ca60a62ef7"></a><!-- doxytag: member="general&#45;sysutils.inc::_list_folder_items" ref="afe814a8de5621ae3af1921ca60a62ef7" args="($folder, $folders_only=true)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">_list_folder_items </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>folder</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>folders_only</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>List folder Items</p>
<p>(utility Used by the functions below) </p>

<p>Definition at line <a class="el" href="general-sysutils_8inc_source.html#l00422">422</a> of file <a class="el" href="general-sysutils_8inc_source.html">general-sysutils.inc</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="general-sysutils_8inc_afe814a8de5621ae3af1921ca60a62ef7_icgraph.png" border="0" usemap="#general-sysutils_8inc_afe814a8de5621ae3af1921ca60a62ef7_icgraph" alt=""/></div>
<map name="general-sysutils_8inc_afe814a8de5621ae3af1921ca60a62ef7_icgraph" id="general-sysutils_8inc_afe814a8de5621ae3af1921ca60a62ef7_icgraph">
<area shape="rect" id="node3" href="general-sysutils_8inc.html#ac8c969cd307ea955528ab54a4c307a0f" title="list_expired_items" alt="" coords="193,32,319,61"/><area shape="rect" id="node21" href="general-sysutils_8inc.html#ae44efd7c9ed854da2e6246f5d1326f47" title="remove_expired_items" alt="" coords="180,85,332,115"/><area shape="rect" id="node5" href="classbackupvfs__fileio__c.html#a29da45ee871140adbdf0b0da1ebd2423" title="backupvfs_fileio_c::_vfs_list_expired_items" alt="" coords="395,5,669,35"/><area shape="rect" id="node17" href="classlocalexec__c.html#ac72ad9f570c48e1d61faf54bb6067ffd" title="localexec_c::exec" alt="" coords="469,59,595,88"/><area shape="rect" id="node7" href="classbackupvfs__fileio__c.html#a6d122a7b0f70f6cdf2960be140a568e0" title="backupvfs_fileio_c::_vfs_prune_expired_backups" alt="" coords="731,112,1037,141"/><area shape="rect" id="node9" href="classbackupvfs__sshremote__c.html#a45a78f43a940f17654c557802f7bbe21" title="backupvfs_sshremote_c::vfs_prune_expired_backups" alt="" coords="1111,32,1444,61"/><area shape="rect" id="node11" href="classbackupvfs__sshremote__rotation__c.html#a45a78f43a940f17654c557802f7bbe21" title="backupvfs_sshremote_rotation_c::vfs_prune_expired_backups" alt="" coords="1085,85,1469,115"/><area shape="rect" id="node13" href="classbackupvfs__localio__c.html#a45a78f43a940f17654c557802f7bbe21" title="backupvfs_localio_c::vfs_prune_expired_backups" alt="" coords="1123,139,1432,168"/><area shape="rect" id="node15" href="classbackupvfs__localio__rotation__c.html#a45a78f43a940f17654c557802f7bbe21" title="backupvfs_localio_rotation_c::vfs_prune_expired_backups" alt="" coords="1097,192,1457,221"/><area shape="rect" id="node19" href="classlocalexec__c.html#a3222532b78daa37e60441c2c04f64546" title="localexec_c::__construct" alt="" coords="801,59,967,88"/><area shape="rect" id="node23" href="classbackupvfs__fileio__c.html#ad165606711d3ffa3dfb8fe5747110dd8" title="backupvfs_fileio_c::_vfs_remove_expired_items" alt="" coords="381,112,683,141"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a9cd4c1a0d42557daac1fc1c94af8eaac"></a><!-- doxytag: member="general&#45;sysutils.inc::can_hardlink" ref="a9cd4c1a0d42557daac1fc1c94af8eaac" args="($target_dir, $source_dir)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">can_hardlink </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>target_dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>source_dir</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>can_hardlink( $target_dir, $source_dir )</p>
<p>Brute-force check to see if it is possible to create a hardlink between files in two directories.</p>
<p>returns false if either folder does not have read/write access. This can be either because the path is not valid or because the permissions do not allow access for any reason.</p>
<p>returns true if the canonical paths of source_dir and target_dir are identical.</p>
<p>Otherwise creates a temporary file in the target dir and attempts to hardlink to it from the source dir. Returns true if the attempt is successful and false if not. Temporary files are, of course, removed before returning the result.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$target_dir</td><td>path to the target directory </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$source_dir</td><td>path to the source directory </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>bool true if it is possible to hardlink files between the source and target directories </dd></dl>

<p>Definition at line <a class="el" href="general-sysutils_8inc_source.html#l00308">308</a> of file <a class="el" href="general-sysutils_8inc_source.html">general-sysutils.inc</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="general-sysutils_8inc_a9cd4c1a0d42557daac1fc1c94af8eaac_cgraph.png" border="0" usemap="#general-sysutils_8inc_a9cd4c1a0d42557daac1fc1c94af8eaac_cgraph" alt=""/></div>
<map name="general-sysutils_8inc_a9cd4c1a0d42557daac1fc1c94af8eaac_cgraph" id="general-sysutils_8inc_a9cd4c1a0d42557daac1fc1c94af8eaac_cgraph">
<area shape="rect" id="node3" href="general-utils_8inc.html#a6185d0c82f5be193802f7bd846fdd9f6" title="dir_fn" alt="" coords="151,5,204,35"/><area shape="rect" id="node5" href="general-utils_8inc.html#a0055ef7f48b70fd8f1c75cc5304b34bb" title="single_chars" alt="" coords="255,5,348,35"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="general-sysutils_8inc_a9cd4c1a0d42557daac1fc1c94af8eaac_icgraph.png" border="0" usemap="#general-sysutils_8inc_a9cd4c1a0d42557daac1fc1c94af8eaac_icgraph" alt=""/></div>
<map name="general-sysutils_8inc_a9cd4c1a0d42557daac1fc1c94af8eaac_icgraph" id="general-sysutils_8inc_a9cd4c1a0d42557daac1fc1c94af8eaac_icgraph">
<area shape="rect" id="node3" href="classbackupvfs__fileio__c.html#a1809a0aad898b2addc9c00785e0e64d2" title="backupvfs_fileio_c::_vfs_can_hardlink" alt="" coords="149,5,392,35"/><area shape="rect" id="node5" href="classlocalexec__c.html#ac72ad9f570c48e1d61faf54bb6067ffd" title="localexec_c::exec" alt="" coords="208,59,333,88"/><area shape="rect" id="node9" href="classbackupvfs__localio__rotation__c.html#a6187bbcd771dd6107b31f2193e6c3537" title="backupvfs_localio_rotation_c::vfs_init" alt="" coords="151,112,391,141"/><area shape="rect" id="node7" href="classlocalexec__c.html#a3222532b78daa37e60441c2c04f64546" title="localexec_c::__construct" alt="" coords="441,59,607,88"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="afdf5bfb4e7162d411c1ba5aef80208cf"></a><!-- doxytag: member="general&#45;sysutils.inc::disk_usage" ref="afdf5bfb4e7162d411c1ba5aef80208cf" args="($ref)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">disk_usage </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>ref</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Disk Usage</p>
<p>Find out how much disk space is being used by the specified file_ref (usually a folder)</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$ref</td><td>absolute or relative reference to a folder or file </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>int disk usage in bytes </dd></dl>

<p>Definition at line <a class="el" href="general-sysutils_8inc_source.html#l00405">405</a> of file <a class="el" href="general-sysutils_8inc_source.html">general-sysutils.inc</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="general-sysutils_8inc_afdf5bfb4e7162d411c1ba5aef80208cf_cgraph.png" border="0" usemap="#general-sysutils_8inc_afdf5bfb4e7162d411c1ba5aef80208cf_cgraph" alt=""/></div>
<map name="general-sysutils_8inc_afdf5bfb4e7162d411c1ba5aef80208cf_cgraph" id="general-sysutils_8inc_afdf5bfb4e7162d411c1ba5aef80208cf_cgraph">
<area shape="rect" id="node3" href="general-sysutils_8inc.html#a02958c3bf0b643439bc3005aa643e954" title="subfolder_sizes" alt="" coords="143,5,255,35"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="general-sysutils_8inc_afdf5bfb4e7162d411c1ba5aef80208cf_icgraph.png" border="0" usemap="#general-sysutils_8inc_afdf5bfb4e7162d411c1ba5aef80208cf_icgraph" alt=""/></div>
<map name="general-sysutils_8inc_afdf5bfb4e7162d411c1ba5aef80208cf_icgraph" id="general-sysutils_8inc_afdf5bfb4e7162d411c1ba5aef80208cf_icgraph">
<area shape="rect" id="node3" href="general-sysutils_8inc.html#ac8c969cd307ea955528ab54a4c307a0f" title="list_expired_items" alt="" coords="143,112,268,141"/><area shape="rect" id="node5" href="classbackupvfs__fileio__c.html#a29da45ee871140adbdf0b0da1ebd2423" title="backupvfs_fileio_c::_vfs_list_expired_items" alt="" coords="317,85,592,115"/><area shape="rect" id="node17" href="classlocalexec__c.html#ac72ad9f570c48e1d61faf54bb6067ffd" title="localexec_c::exec" alt="" coords="392,139,517,168"/><area shape="rect" id="node7" href="classbackupvfs__fileio__c.html#a6d122a7b0f70f6cdf2960be140a568e0" title="backupvfs_fileio_c::_vfs_prune_expired_backups" alt="" coords="640,85,947,115"/><area shape="rect" id="node9" href="classbackupvfs__sshremote__c.html#a45a78f43a940f17654c557802f7bbe21" title="backupvfs_sshremote_c::vfs_prune_expired_backups" alt="" coords="1020,5,1353,35"/><area shape="rect" id="node11" href="classbackupvfs__sshremote__rotation__c.html#a45a78f43a940f17654c557802f7bbe21" title="backupvfs_sshremote_rotation_c::vfs_prune_expired_backups" alt="" coords="995,59,1379,88"/><area shape="rect" id="node13" href="classbackupvfs__localio__c.html#a45a78f43a940f17654c557802f7bbe21" title="backupvfs_localio_c::vfs_prune_expired_backups" alt="" coords="1032,112,1341,141"/><area shape="rect" id="node15" href="classbackupvfs__localio__rotation__c.html#a45a78f43a940f17654c557802f7bbe21" title="backupvfs_localio_rotation_c::vfs_prune_expired_backups" alt="" coords="1007,165,1367,195"/><area shape="rect" id="node19" href="classlocalexec__c.html#a3222532b78daa37e60441c2c04f64546" title="localexec_c::__construct" alt="" coords="711,139,876,168"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ac8c969cd307ea955528ab54a4c307a0f"></a><!-- doxytag: member="general&#45;sysutils.inc::list_expired_items" ref="ac8c969cd307ea955528ab54a4c307a0f" args="($folder, $max_items, $folders_only=true)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">list_expired_items </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>folder</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>max_items</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>folders_only</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>List Expired Items</p>
<p>Procedure:</p>
<p>(1) Get a list of the items in the specified folder. (2) Subtract the most recent $max_items items from the list (3) List the remaining items from the list, if any.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$folder</td><td>the folder to scan </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$max_items</td><td>the # of items to keep </td></tr>
    <tr><td class="paramtype">bool</td><td class="paramname">$folders_only</td><td>true to scan folders only - false to scan folders and files </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>array array of expired folder time stamps &amp; sizes by name, ie: $expired["name"] =&gt; array( time stamp, disk usage ); </dd></dl>

<p>Definition at line <a class="el" href="general-sysutils_8inc_source.html#l00534">534</a> of file <a class="el" href="general-sysutils_8inc_source.html">general-sysutils.inc</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="general-sysutils_8inc_ac8c969cd307ea955528ab54a4c307a0f_cgraph.png" border="0" usemap="#general-sysutils_8inc_ac8c969cd307ea955528ab54a4c307a0f_cgraph" alt=""/></div>
<map name="general-sysutils_8inc_ac8c969cd307ea955528ab54a4c307a0f_cgraph" id="general-sysutils_8inc_ac8c969cd307ea955528ab54a4c307a0f_cgraph">
<area shape="rect" id="node3" href="general-sysutils_8inc.html#afe814a8de5621ae3af1921ca60a62ef7" title="_list_folder_items" alt="" coords="183,5,305,35"/><area shape="rect" id="node5" href="general-sysutils_8inc.html#afdf5bfb4e7162d411c1ba5aef80208cf" title="disk_usage" alt="" coords="200,59,288,88"/><area shape="rect" id="node7" href="general-sysutils_8inc.html#a02958c3bf0b643439bc3005aa643e954" title="subfolder_sizes" alt="" coords="356,59,468,88"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="general-sysutils_8inc_ac8c969cd307ea955528ab54a4c307a0f_icgraph.png" border="0" usemap="#general-sysutils_8inc_ac8c969cd307ea955528ab54a4c307a0f_icgraph" alt=""/></div>
<map name="general-sysutils_8inc_ac8c969cd307ea955528ab54a4c307a0f_icgraph" id="general-sysutils_8inc_ac8c969cd307ea955528ab54a4c307a0f_icgraph">
<area shape="rect" id="node3" href="classbackupvfs__fileio__c.html#a29da45ee871140adbdf0b0da1ebd2423" title="backupvfs_fileio_c::_vfs_list_expired_items" alt="" coords="181,85,456,115"/><area shape="rect" id="node15" href="classlocalexec__c.html#ac72ad9f570c48e1d61faf54bb6067ffd" title="localexec_c::exec" alt="" coords="256,139,381,168"/><area shape="rect" id="node5" href="classbackupvfs__fileio__c.html#a6d122a7b0f70f6cdf2960be140a568e0" title="backupvfs_fileio_c::_vfs_prune_expired_backups" alt="" coords="504,85,811,115"/><area shape="rect" id="node7" href="classbackupvfs__sshremote__c.html#a45a78f43a940f17654c557802f7bbe21" title="backupvfs_sshremote_c::vfs_prune_expired_backups" alt="" coords="884,5,1217,35"/><area shape="rect" id="node9" href="classbackupvfs__sshremote__rotation__c.html#a45a78f43a940f17654c557802f7bbe21" title="backupvfs_sshremote_rotation_c::vfs_prune_expired_backups" alt="" coords="859,59,1243,88"/><area shape="rect" id="node11" href="classbackupvfs__localio__c.html#a45a78f43a940f17654c557802f7bbe21" title="backupvfs_localio_c::vfs_prune_expired_backups" alt="" coords="896,112,1205,141"/><area shape="rect" id="node13" href="classbackupvfs__localio__rotation__c.html#a45a78f43a940f17654c557802f7bbe21" title="backupvfs_localio_rotation_c::vfs_prune_expired_backups" alt="" coords="871,165,1231,195"/><area shape="rect" id="node17" href="classlocalexec__c.html#a3222532b78daa37e60441c2c04f64546" title="localexec_c::__construct" alt="" coords="575,139,740,168"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ae44efd7c9ed854da2e6246f5d1326f47"></a><!-- doxytag: member="general&#45;sysutils.inc::remove_expired_items" ref="ae44efd7c9ed854da2e6246f5d1326f47" args="($folder, $max_items, $debug=true, $folders_only=true)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">remove_expired_items </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>folder</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>max_items</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>debug</em> = <code>true</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>folders_only</em> = <code>true</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Remove Expired Items</p>
<p>Procedure:</p>
<p>(1) Get a list of the items in the specified folder. (2) Subtract the most recent $max_items items from the list (3) Delete the remaining items from the list, if any.</p>
<p>To accomplish this the simple solution is to take a list of the items found in a particular folder and sort them by date. This would put the oldest items at the top of the list and the most recent items at the bottom of the list.</p>
<p>It then becomes a small matter to check the size of the list to determine if it's $max_items or less and return if that test is true. Otherwise the top item in the list can be deleted and the test repeated until the test is true.</p>
<p>Returns the number of items removed, zero if none removed or false on error.</p>
<p>This function executes "rm -Rf ..." commands and is often used by scripts that run as root. It's hard to imagine a more frightening place for bugs to be found. Therefore, by default, the debug var is true and the commands are displayed but nothing is actually deleted.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$folder</td><td>the folder to scan </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$max_items</td><td>the # of items to keep </td></tr>
    <tr><td class="paramtype">bool</td><td class="paramname">$debug</td><td>true to display "rm -Rf ..." commands, false to actually execute them (after extensive testing!!) </td></tr>
    <tr><td class="paramtype">bool</td><td class="paramname">$folders_only</td><td>true to scan folders only - false to scan folders and files </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>int number of folders that were deleted </dd></dl>

<p>Definition at line <a class="el" href="general-sysutils_8inc_source.html#l00487">487</a> of file <a class="el" href="general-sysutils_8inc_source.html">general-sysutils.inc</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="general-sysutils_8inc_ae44efd7c9ed854da2e6246f5d1326f47_cgraph.png" border="0" usemap="#general-sysutils_8inc_ae44efd7c9ed854da2e6246f5d1326f47_cgraph" alt=""/></div>
<map name="general-sysutils_8inc_ae44efd7c9ed854da2e6246f5d1326f47_cgraph" id="general-sysutils_8inc_ae44efd7c9ed854da2e6246f5d1326f47_cgraph">
<area shape="rect" id="node3" href="general-sysutils_8inc.html#afe814a8de5621ae3af1921ca60a62ef7" title="_list_folder_items" alt="" coords="209,5,332,35"/><area shape="rect" id="node5" href="general-utils_8inc.html#a6185d0c82f5be193802f7bd846fdd9f6" title="dir_fn" alt="" coords="244,59,297,88"/><area shape="rect" id="node7" href="general-utils_8inc.html#a0055ef7f48b70fd8f1c75cc5304b34bb" title="single_chars" alt="" coords="383,59,476,88"/></map>
</div>
</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="general-sysutils_8inc_ae44efd7c9ed854da2e6246f5d1326f47_icgraph.png" border="0" usemap="#general-sysutils_8inc_ae44efd7c9ed854da2e6246f5d1326f47_icgraph" alt=""/></div>
<map name="general-sysutils_8inc_ae44efd7c9ed854da2e6246f5d1326f47_icgraph" id="general-sysutils_8inc_ae44efd7c9ed854da2e6246f5d1326f47_icgraph">
<area shape="rect" id="node3" href="classbackupvfs__fileio__c.html#ad165606711d3ffa3dfb8fe5747110dd8" title="backupvfs_fileio_c::_vfs_remove_expired_items" alt="" coords="208,85,509,115"/><area shape="rect" id="node15" href="classlocalexec__c.html#ac72ad9f570c48e1d61faf54bb6067ffd" title="localexec_c::exec" alt="" coords="296,139,421,168"/><area shape="rect" id="node5" href="classbackupvfs__fileio__c.html#a6d122a7b0f70f6cdf2960be140a568e0" title="backupvfs_fileio_c::_vfs_prune_expired_backups" alt="" coords="557,85,864,115"/><area shape="rect" id="node7" href="classbackupvfs__sshremote__c.html#a45a78f43a940f17654c557802f7bbe21" title="backupvfs_sshremote_c::vfs_prune_expired_backups" alt="" coords="937,5,1271,35"/><area shape="rect" id="node9" href="classbackupvfs__sshremote__rotation__c.html#a45a78f43a940f17654c557802f7bbe21" title="backupvfs_sshremote_rotation_c::vfs_prune_expired_backups" alt="" coords="912,59,1296,88"/><area shape="rect" id="node11" href="classbackupvfs__localio__c.html#a45a78f43a940f17654c557802f7bbe21" title="backupvfs_localio_c::vfs_prune_expired_backups" alt="" coords="949,112,1259,141"/><area shape="rect" id="node13" href="classbackupvfs__localio__rotation__c.html#a45a78f43a940f17654c557802f7bbe21" title="backupvfs_localio_rotation_c::vfs_prune_expired_backups" alt="" coords="924,165,1284,195"/><area shape="rect" id="node17" href="classlocalexec__c.html#a3222532b78daa37e60441c2c04f64546" title="localexec_c::__construct" alt="" coords="628,139,793,168"/></map>
</div>
</p>

</div>
</div>
<a class="anchor" id="a02958c3bf0b643439bc3005aa643e954"></a><!-- doxytag: member="general&#45;sysutils.inc::subfolder_sizes" ref="a02958c3bf0b643439bc3005aa643e954" args="($dir, $depth=1, $du_opts=&quot;&quot;, $du_bin=false)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">subfolder_sizes </td>
          <td>(</td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>dir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>depth</em> = <code>1</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>du_opts</em> = <code>&quot;&quot;</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">$&#160;</td>
          <td class="paramname"><em>du_bin</em> = <code>false</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>subfolder_sizes( $dir )</p>
<p>Returns an array of relative paths to subfolders containing the following information:</p>
<ul>
<li>At Index 0: The last date/time of a change in any of the files or subfolders within the subfolder.</li>
</ul>
<ul>
<li>At Index 1: The total number of disk usage bytes used within the subfolder</li>
</ul>
<p>The DU command is used to compile the information. It returns a single line of results for each subfolder and, at the end, a summary line for the specified $dir showing the last date/time of a change to a file within the folder tree and the total size of the folder tree. Because the $dir is removed from the return results the summary information is usually available at index "" (ie: $r[""] contains a summary record) if $dir is passed with a trailing slash.</p>
<p>Returns false if an error occurs.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramtype">string</td><td class="paramname">$dir</td><td>the folder to scan </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$depth</td><td>the # of subfolder levels to report in results </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$du_opts</td><td>optional options passed to the DU utility </td></tr>
    <tr><td class="paramtype">string</td><td class="paramname">$du_bin</td><td>optional path to the DU binary </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>array an array of subfolders found, each with associated size and lastmod time info </dd></dl>

<p>Definition at line <a class="el" href="general-sysutils_8inc_source.html#l00373">373</a> of file <a class="el" href="general-sysutils_8inc_source.html">general-sysutils.inc</a>.</p>

<p><div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="general-sysutils_8inc_a02958c3bf0b643439bc3005aa643e954_icgraph.png" border="0" usemap="#general-sysutils_8inc_a02958c3bf0b643439bc3005aa643e954_icgraph" alt=""/></div>
<map name="general-sysutils_8inc_a02958c3bf0b643439bc3005aa643e954_icgraph" id="general-sysutils_8inc_a02958c3bf0b643439bc3005aa643e954_icgraph">
<area shape="rect" id="node3" href="general-sysutils_8inc.html#afdf5bfb4e7162d411c1ba5aef80208cf" title="disk_usage" alt="" coords="168,112,256,141"/><area shape="rect" id="node5" href="general-sysutils_8inc.html#ac8c969cd307ea955528ab54a4c307a0f" title="list_expired_items" alt="" coords="305,112,431,141"/><area shape="rect" id="node7" href="classbackupvfs__fileio__c.html#a29da45ee871140adbdf0b0da1ebd2423" title="backupvfs_fileio_c::_vfs_list_expired_items" alt="" coords="480,85,755,115"/><area shape="rect" id="node19" href="classlocalexec__c.html#ac72ad9f570c48e1d61faf54bb6067ffd" title="localexec_c::exec" alt="" coords="555,139,680,168"/><area shape="rect" id="node9" href="classbackupvfs__fileio__c.html#a6d122a7b0f70f6cdf2960be140a568e0" title="backupvfs_fileio_c::_vfs_prune_expired_backups" alt="" coords="803,85,1109,115"/><area shape="rect" id="node11" href="classbackupvfs__sshremote__c.html#a45a78f43a940f17654c557802f7bbe21" title="backupvfs_sshremote_c::vfs_prune_expired_backups" alt="" coords="1183,5,1516,35"/><area shape="rect" id="node13" href="classbackupvfs__sshremote__rotation__c.html#a45a78f43a940f17654c557802f7bbe21" title="backupvfs_sshremote_rotation_c::vfs_prune_expired_backups" alt="" coords="1157,59,1541,88"/><area shape="rect" id="node15" href="classbackupvfs__localio__c.html#a45a78f43a940f17654c557802f7bbe21" title="backupvfs_localio_c::vfs_prune_expired_backups" alt="" coords="1195,112,1504,141"/><area shape="rect" id="node17" href="classbackupvfs__localio__rotation__c.html#a45a78f43a940f17654c557802f7bbe21" title="backupvfs_localio_rotation_c::vfs_prune_expired_backups" alt="" coords="1169,165,1529,195"/><area shape="rect" id="node21" href="classlocalexec__c.html#a3222532b78daa37e60441c2c04f64546" title="localexec_c::__construct" alt="" coords="873,139,1039,168"/></map>
</div>
</p>

</div>
</div>
</div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="general-sysutils_8inc.html">general-sysutils.inc</a>      </li>
      <li class="footer">Generated on Tue Jan 10 2012 14:54:12 for SysBackup by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.4 </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>
